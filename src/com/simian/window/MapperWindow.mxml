<?xml version="1.0" encoding="utf-8"?>
<flexlib:MDIWindow		 
	backgroundColor="0xc0c0c0"
	width="600" height="600"
	showCloseButton="true"
	xmlns:flexlib="http://code.google.com/p/flexlib/"	
	xmlns:mate="http://mate.asfusion.com/"
	xmlns:mx="http://www.adobe.com/2006/mxml"	 	
	name="mapperWindow"		
 	creationComplete="init()"
 	title="{oMap.map_name}"
 	styleName="standardPadding"		 	
>


  <mx:Script>
  <![CDATA[
  	import flexlib.scheduling.scheduleClasses.utils.Selection;
  	import mx.binding.utils.ChangeWatcher;
  	
  	import com.simian.mapper.Room;
  	import com.simian.mapper.MapperEvent;
  	
  	import com.simian.mapper.Map;

	import mx.binding.utils.BindingUtils;



  	[Bindable]
	public var oMap : Map;
  
  	[Bindable]
  	public var current_room : Room = new Room();
  	
  	[Bindable]
  	public var selected_room : Room;
  	
  	public var bMappingEnabled : Boolean = false;
  
  	public var watcher:ChangeWatcher;
  
 	private function init() : void { 		

		updateToggleLabel();
 		
 		watcher = ChangeWatcher.watch(this,"current_room",roomChange);
 		  		
 	} 
 	
 	private function roomChange(e:Event) : void {
 		
 		if (current_room != null) {
 			
	 		form_heading.text = current_room.room_name;
	 		form_desc.text = current_room.room_line1+ ' ' + current_room.room_line2 + ' ' + current_room.room_line3;
	 		
 			mapview.changeRoom();
 		}
 		
 	}
 	
 	private function updateToggleLabel() : void {
 		if (bMappingEnabled) toggle_mapper.label = 'stop mapping';
 		else toggle_mapper.label = 'start mapping';
 	}
 	
 	private function toggle_mapping() : void {

		// despatch a mapping start/stop even
    	var mEvent : MapperEvent;       	

 		if (bMappingEnabled){ 
 			bMappingEnabled = false;
 			mEvent = new MapperEvent(MapperEvent.MAPPER_STOP);
 		}
 		else { 
 			bMappingEnabled = true;
 			mEvent = new MapperEvent(MapperEvent.MAPPER_START);
 		}
		dispatchEvent(mEvent);

 		updateToggleLabel();
 	}
 	
 	private function find() : void { 		
 		// despatch a mapping start/stop even
    	var mEvent : MapperEvent;       	
		mEvent = new MapperEvent(MapperEvent.MAPPER_FIND);
		dispatchEvent(mEvent);		
 	}
  
  
  	private function deleteSelected() : void {
  		if (selected_room != null) oMap.deleteRoom(selected_room);
  	}
  
  
  ]]>  
  </mx:Script>

	
	<mx:TabNavigator id="mapTabs" width="100%" height="100%" verticalGap="2" paddingTop="2" creationPolicy="all">

		<mx:VBox label="Map" styleName="standardPadding">

			<mx:HBox>		
				<mx:Button id="toggle_mapper" click="toggle_mapping()" />
				<mx:Button label="find" click="find()" />
				<mx:Button label="delete" click="deleteSelected()" />	
			</mx:HBox>
			
			<mapper:MapView 
				xmlns:mapper="com.simian.mapper.*" 		
				map="{oMap}" 
				width="100%" 
				height="100%" 
				id="mapview" 
				current_room="{current_room}"
			/>	
		</mx:VBox>
		
		
		
		<mx:Form label="Current Room" width="100%" height="100%" styleName="standardPadding">
			
			<mx:FormItem label="Name : " width="100%">
				<mx:Label id="form_heading" />
			</mx:FormItem>

			<mx:FormItem label="Desc : " width="100%">
				<mx:TextArea id="form_desc" enabled="false" width="100%" height="60" />	
			</mx:FormItem>
			
		</mx:Form>
		
	</mx:TabNavigator>
	
	
	
				
</flexlib:MDIWindow>
